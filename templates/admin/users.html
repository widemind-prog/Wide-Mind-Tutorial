{% extends "base.html" %}
{% block title %}Admin – Users{% endblock %}

{% block content %}
<section class="admin-dashboard">
    <h1 class="dashboard-title">User Management</h1>
    <p class="dashboard-subtitle">View users, manage access, and handle payments.</p>

    <div class="admin-box">
        {% if users %}
        <div class="users-grid">
            {% for user in users %}
            <div class="user-card">
                <strong>{{ user.name }}</strong><br>
                <small>{{ user.email }}</small><br>
                <small>Level: {{ user.level or "N/A" }}</small><br>
                <small>Role: {{ user.role }}</small><br>

                <!-- ACCOUNT STATUS -->
                {% if user.is_suspended %}
                    <p style="color:red;">Status: Suspended</p>
                {% else %}
                    <p style="color:green;">Status: Active</p>
                {% endif %}

                <!-- PAYMENT STATUS -->
                {% if user.role != "admin" %}
                    <p>Payment:
                        {% if user.payment_status == "paid" %}
                            <strong style="color:green;">Paid</strong>
                        {% else %}
                            <strong style="color:red;">Unpaid</strong>
                        {% endif %}
                    </p>
                {% endif %}

                <!-- ACTIONS -->
                <form method="POST">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">

                    <!-- TOGGLE SUSPEND -->
                    <button formaction="/dashboard/users/suspend/{{ user.id }}" type="submit">
                        {% if user.is_suspended %}Unsuspend{% else %}Suspend{% endif %}
                    </button>

                    <!-- TOGGLE PAYMENT -->
                    {% if user.role != "admin" %}
                    <button
                        formaction="/dashboard/users/mark-paid/{{ user.id }}"
                        type="submit"
                        style="background:#0a7c2f;">
                        {% if user.payment_status == "paid" %}Mark Unpaid{% else %}Mark Paid{% endif %}
                    </button>
                    {% endif %}

                    <!-- DELETE -->
                    <button
                        formaction="/dashboard/users/delete/{{ user.id }}"
                        type="submit"
                        style="background:#a00000;">
                        Delete Permanently
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% else %}
            <p>No users found.</p>
        {% endif %}
    </div>

    <a href="/dashboard" class="back-login-btn">← Back to Dashboard</a>
</section>

<!-- Toast for admin actions -->
<div id="admin-toast" class="toast"></div>

<!-- JS -->
<script src="/static/js/admin.js"></script>

<!-- Styles -->
<style>
.users-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}
.user-card {
    border: 1px solid #ccc;
    padding: 15px;
    border-radius: 10px;
    width: 220px;
    background: #fafafa;
}
.user-card button {
    margin-top: 5px;
    margin-right: 5px;
    padding: 5px 10px;
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}
.user-card button[type="submit"] {
    background: #007bff;
}
.user-card button[style*="#0a7c2f"] {
    background: #0a7c2f;
}
.user-card button[style*="#a00000"] {
    background: #a00000;
}
</style>
{% endblock %}