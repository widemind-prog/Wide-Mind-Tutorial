{% extends "base.html" %}

{% block title %}Admin â€“ Users{% endblock %}

{% block content %}
<section class="admin-dashboard">

    <h1 class="dashboard-title">User Management</h1>
    <p class="dashboard-subtitle">View users, manage access, and handle payments.</p>
    <div class="stats-grid">
      <div class="stat-card">
          <h3>Total Users</h3>
          <p>{{ total_users }}</p>
      </div>

      <div class="stat-card paid">
          <h3>Paid Users</h3>
          <p>{{ paid_users }}</p>
      </div>

      <div class="stat-card unpaid">
          <h3>Unpaid Users</h3>
          <p>{{ unpaid_users }}</p>
      </div>

      <div class="stat-card suspended">
          <h3>Suspended</h3>
          <p>{{ suspended_users }}</p>
      </div>
    </div>

    <div class="admin-box">

        {% if users %}
        <div class="users-grid">
            {% for user in users %}
            <div class="user-card">
                <strong>{{ user.name }}</strong><br>
                <small>{{ user.email }}</small><br>
                <small>Level: {{ user.level or "N/A" }}</small><br>
                <small>Role: {{ user.role }}</small><br>

                <!-- ACCOUNT STATUS -->
                {% if user.is_suspended %}
                    <p style="color:red;">Status: Suspended</p>
                {% else %}
                    <p style="color:green;">Status: Active</p>
                {% endif %}

                <!-- PAYMENT STATUS -->
                {% if user.role != "admin" %}
                    <p>Payment:
                        {% if user.payment_status == "paid" %}
                            <strong style="color:green;">Paid</strong>
                        {% else %}
                            <strong style="color:red;">Unpaid</strong>
                        {% endif %}
                    </p>
                {% endif %}

                <!-- ACTIONS -->
                <form method="POST" class="user-actions">

                    <!-- TOGGLE SUSPEND -->
                    <button
                        type="button"
                        class="btn-suspend"
                        data-url="/admin/users/suspend/{{ user.id }}">
                        {% if user.is_suspended %}Unsuspend{% else %}Suspend{% endif %}
                    </button>

                    <!-- TOGGLE PAYMENT -->
                    {% if user.role != "admin" %}
                        <button
                            type="button"
                            class="btn-payment"
                            data-url="/admin/users/mark-paid/{{ user.id }}"
                            style="background:#0a7c2f;">
                            {% if user.payment_status == "paid" %}Mark Unpaid{% else %}Mark Paid{% endif %}
                        </button>
                    {% endif %}

                    <!-- DELETE -->
                    <button
                        type="button"
                        class="btn-delete"
                        data-url="/admin/users/delete/{{ user.id }}"
                        style="background:#a00000;">
                        Delete Permanently
                    </button>

                </form>
            </div>
            {% endfor %}
        </div>
        {% else %}
            <p>No users found.</p>
        {% endif %}

    </div>

    <a href="/admin/" class="back-login-btn">â† Back to Dashboard</a>

</section>

<!-- Toast for admin actions -->
<div id="admin-toast" class="toast"></div>

<script src="/static/js/admin.js"></script>
{% endblock %}