{% extends "base.html" %}

{% block title %}{{ course.course_code }} - {{ course.course_title }}{% endblock %}

{% block content %}

<h2>{{ course.course_code }} - {{ course.course_title }}</h2>

{% if audios %}
  <h3>Audio Lessons üéß</h3>
  <ul style="list-style: none; padding-left: 0;">
    {% for audio in audios %}
      <li style="margin-bottom: 15px;">
        <p>{{ audio.title or audio.filename }}</p>
        <audio id="audio-{{ audio.id }}" controls
               style="display: block; margin-left: 0; margin-right: auto;"
               disablePictureInPicture>
          <source src="/stream/audio/{{ audio.id }}" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
      </li>
    {% endfor %}
  </ul>
{% endif %}

{% if pdfs %}
  <h3>PDF Lessons üìù</h3>
  <ul style="list-style: none; padding-left: 0;">
    {% for pdf in pdfs %}
      <li style="margin-bottom: 10px;">
        <a href="/course/{{ course.id }}/pdf" target="_blank" rel="noopener noreferrer">
          {{ pdf.title or pdf.filename }}
        </a>
      </li>
    {% endfor %}
  </ul>
{% endif %}

<!-- Toast for messages -->
<div id="toast" class="toast"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const toast = document.getElementById("toast");

    // Toast helper
    function showToast(message, isError = false) {
        if (!toast) return;
        toast.textContent = message;
        toast.style.background = isError ? "#a00000" : "#333";
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
    }

    // Protect audio elements
    document.querySelectorAll("audio").forEach(audio => {
        // Disable right-click
        audio.addEventListener("contextmenu", e => {
            e.preventDefault();
            showToast("Right-click disabled on audio üéß", true);
        });

        // Disable dragging
        audio.addEventListener("dragstart", e => e.preventDefault());

        // Hide download button but allow playback speed
        audio.setAttribute("controlsList", "nodownload");

        // Disable Picture-in-Picture
        audio.setAttribute("disablePictureInPicture", "true");

        // Left-align audio player
        audio.style.display = "block";
        audio.style.marginLeft = "0";
        audio.style.marginRight = "auto";
    });
});
</script>

{% endblock %}