{% extends "base.html" %}

{% block title %}{{ course.course_code }} - {{ course.course_title }}{% endblock %}

{% block content %}

<h2>{{ course.course_code }} - {{ course.course_title }}</h2>

{# ===== COURSE OVERVIEW AS HERO CARD ===== #}
{% if course.description %}
  <div class="hero-description">
    <h3>Course Overview ğŸ“˜</h3>
    <p>{{ course.description }}</p>
  </div>
{% endif %}

{# ===== AUDIO LESSONS ===== #}
{% if audios %}
  <h3>Audio Lessons ğŸ§</h3>
  <ul style="list-style: none; padding-left: 0;">
    {% for audio in audios %}
      <li style="margin-bottom: 15px;">
        <p>{{ audio.title or audio.filename }}</p>
        <audio id="audio-{{ audio.id }}" controls disablePictureInPicture style="display:block; margin:0 auto;">
          <source src="/stream/audio/{{ audio.id }}" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <div class="hero-description" style="text-align:center; margin-top: 15px;">
    <p><strong>No audio lessons yet. Materials will be uploaded soon! ğŸ§</strong></p>
  </div>
{% endif %}

{# ===== PDF LESSONS ===== #}
{% if pdfs %}
  <h3>PDF Lessons ğŸ“</h3>
  <ul style="list-style: none; padding-left: 0;">
    {% for pdf in pdfs %}
      <li style="margin-bottom: 10px;">
        <a href="/course/{{ course.id }}/pdf" target="_blank" rel="noopener noreferrer">
          {{ pdf.title or pdf.filename }}
        </a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <div class="hero-description" style="text-align:center; margin-top: 15px;">
    <p><strong>No PDF lessons yet. Materials will be uploaded soon! ğŸ“</strong></p>
  </div>
{% endif %}

{# ===== TOAST MESSAGES ===== #}
<div id="toast" class="toast"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const toast = document.getElementById("toast");

    // Toast helper
    function showToast(message, isError = false) {
        if (!toast) return;
        toast.textContent = message;
        toast.style.background = isError ? "#a00000" : "#333";
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
    }

    // Protect audio elements
    document.querySelectorAll("audio").forEach(audio => {
        // Disable right-click
        audio.addEventListener("contextmenu", e => {
            e.preventDefault();
            showToast("Right-click disabled on audio ğŸ§", true);
        });

        // Disable dragging
        audio.addEventListener("dragstart", e => e.preventDefault());

        // Hide download button
        audio.setAttribute("controlsList", "nodownload");
        audio.setAttribute("disablePictureInPicture", "true");

        // Left-align audio player
        audio.style.display = "block";
        audio.style.marginLeft = "0";
        audio.style.marginRight = "auto";
    });
});
</script>

{% endblock %}